"use strict";(self.webpackChunkembed_widget=self.webpackChunkembed_widget||[]).push([[9708],{62910:(e,t,i)=>{i.r(t),i.d(t,{Loader:()=>v,default:()=>b});var o=i(9950),s=i(96011),a=i.n(s),l=i(61056),r=(i(92043),i(36907)),n=i(93807),d=i(66345);const p=d.HY?"cloud.tagshop.ai":"cloud.tagbox.com";const h=class{constructor(e,t,i){let o="media/tmpimages/",s=p;d.Qy&&(o="ugc-suite/tmp/",s="cloud.tagbox.com"),d.HY&&(o="tmp/"),this.uppy=new r.A({meta:{type:"avatar"},autoProceed:!0,debug:!0,allowMultipleUploads:!0,restrictions:{maxFileSize:104857600,maxNumberOfFiles:i||1,minNumberOfFiles:1,allowedFileTypes:["image/*","video/*"]},onBeforeFileAdded:e,onBeforeUpload:t}),this.uppy.use(n.Ay,{params:{auth:{key:"0701d3d7f8d94e92a65a9cba388b1d96"},steps:{store:{robot:"/wasabi/store",bucket_region:"us-west-1",result:!0,bucket:s,key:"47ABVORKG52UYE1KB28S",secret:"pcaTfeokaz28geAAns08H3yaGbOVz6ILgTptu19v",path:o+"${file.id}.${file.ext}"}}},waitForEncoding:!0})}};var u=i(76506),c=i(80415),m=i(41397),g=i.n(m),f=i(44414);const v=e=>{let{value:t,isBar:i}=e;const o=Math.round((100-t)/100*182.12);return i?(0,f.jsx)("div",{className:"t_m_pb_wrap",children:(0,f.jsx)("div",{className:"t_m_pb",style:{width:`${t}%`},children:(0,f.jsx)("div",{})})}):(0,f.jsx)("div",{className:"t_m_propgress",children:(0,f.jsxs)("svg",{width:"78",height:"78",viewBox:"-10 -10 100 100",version:"1.1",xmlns:"http://www.w3.org/2000/svg",style:{transform:"rotate(-90deg)"},children:[(0,f.jsx)("circle",{r:"30",cx:"40",cy:"40",fill:"transparent",stroke:"#D9D9D9",strokeWidth:"4",strokeDasharray:"188.4px",strokeDashoffset:"0"}),(0,f.jsx)("circle",{id:"path_fr_circle",r:"30",cx:"40",cy:"40",stroke:"#545454",strokeWidth:"4",strokeLinecap:"butt",strokeDashoffset:`${o}px`,fill:"transparent",strokeDasharray:"188.4px"}),(0,f.jsxs)("text",{x:"25px",y:"47px",fill:"#545454",fontSize:"14px",style:{transform:"rotate(90deg) translate(17px, -84px)"},textAnchor:"middle",dominantBaseline:"middle",children:[t,"%"]})]})})};let w=[],y=[];class x extends o.Component{constructor(){super(...arguments),this.state={isLoading:!1,selectedFile:null,selectedUrl:null,type:null,thumb_file:[],fileSize:!1,filemaxSize:0,throwError:!1,videoPath:"",fileSizeText:"",ext:null,size:0,fileName:null,mediaHeight:0,mediaWidth:0,uploadPercent:100,limit:20,uploadedFiles:[]},this.beforeFileAdded=(e,t)=>{if(this.props.checkUpload(!0),y.length>0){if(y.find(t=>t.id==e.id))return!1}(0,u.Uy)(1);const{size:i,sizeText:o}=(0,u.Cq)(e.size),s=e.meta.type.includes("image")?4:5;if(["GB","TB"].includes(o))this.setState({type:s,fileSize:!0,fileSizeText:`${i}${o}`},()=>{this.onLoadError(s),setTimeout(()=>this.setState({fileSize:!1,fileSizeText:""}),2e3)}),(0,u.Uy)(2);else if("MB"==o){const t=4==s?15:100;if(i>=t)return this.setState({type:s,filemaxSize:t,fileSize:!0,fileSizeText:`${i}${o}`},()=>{this.onLoadError(s),setTimeout(()=>this.setState({fileSize:!1,fileSizeText:"",type:null},()=>this.onLoadError(s)),5e3)}),(0,u.Uy)(2),!1;5==s?y.length<20&&(w.push(e),y.push(e)):y.length<20&&y.push(e)}else"KB"==o&&y.length<20&&(e.meta.type.includes("video")&&w.push(e),y.push(e))},this.beforeUpload=e=>{for(const t of y)if(t.meta.type.includes("video")){this.videoProcess();break}return this.setState({isLoading:!0}),Object.fromEntries(Object.entries(e).filter(e=>{let[t,i]=e;return!i.meta.type.includes("video")}))},this.videoProcess=()=>{if(w.length>0&&y.length<=20)try{const{onsite_token:e,checkUpload:t}=this.props;this.setState({isLoading:!0});const i=w[0],o=new FormData;o.append("file",i.data),o.append("onsite_token",e);const s={headers:{productdomain:"taggbox.com"},onUploadProgress:e=>{const t=Math.round(100*e.loaded/e.total);this.setState({uploadPercent:t,isLoading:!0})}};a().post(d.Pt,o,s).then(e=>{const{responseData:o}=e.data;o&&o.length>0&&(this.setState(e=>({videoPath:o[0].sscode,isLoading:!1,type:5,selectedFile:o[0].s3Url,selectedUrl:o[0].s3Url,thumb_file:o[0].s3ThumbUrl,ext:i.extension,size:i.size,fileName:i.name,mediaHeight:o[0].height,mediaWidth:o[0].width,uploadedFiles:[...e.uploadedFiles,{name:i.name,url:o[0].s3Url,id:i.id}]}),()=>{this.onUpdateLocalState(),w.shift(),this.videoProcess()}),(0,u.Uy)(2),t(!1))}).catch(e=>{y=y.filter(e=>e.id!=i.id),this.setState({isLoading:!1,throwError:!0},()=>setTimeout(()=>this.setState({throwError:!1}),2e3)),(0,u.Uy)(2),t(!1)})}catch(e){this.videoProcess(),this.setState({isLoading:!1,throwError:!0},()=>setTimeout(()=>this.setState({throwError:!1}),2e3)),this.uppyUploader.uppy.cancelAll(),(0,u.Uy)(2),this.props.checkUpload(!1)}},this.uppyUploader=new h(this.beforeFileAdded,this.beforeUpload,this.state.limit),this.onRemovedState=e=>{const{type:t}=this.state;this.setState({selectedFile:null,selectedUrl:null,type:null,thumb_file:"",fileSize:!1,fileSizeText:"",videoPath:"",ext:null,size:0,fileName:null,mediaHeight:0,mediaWidth:0},()=>{this.onLoadError(t),e&&this.uppyUploader.uppy.cancelAll()})},this.onUpdateLocalState=()=>{const{addPostImage:e,isActiveIndex:t}=this.props,{selectedUrl:i,type:o,thumb_file:s,videoPath:a,ext:l,size:r,fileName:n,mediaHeight:d,mediaWidth:p,uploadedFiles:h}=this.state;e(i,5===o?s:i,o,d,p,a,t,l,r,n),5===o&&this.onRemovedState(!1)},this.onLoadError=e=>{const{uploadErrorCallback:t}=this.props,{fileSize:i,fileSizeText:o,filemaxSize:s,throwError:a}=this.state,l=i?`File Size (${o}) Limit Exceeded ${4==e?"Image":"Video"} Size : Max ${s} MB`:"",r=a?"Something went wrong , Please try again.":"";t(l||(r||""))}}componentDidMount(){this.uppyUploader.uppy.on("transloadit:result",(e,t)=>{this.setState({isLoading:!1});const i=t.meta.orientation&&"Rotate 90 CW"==t.meta.orientation?t.meta.width:t.meta.height,o=t.meta.orientation&&"Rotate 90 CW"==t.meta.orientation?t.meta.height:t.meta.width;let s=`${c.vr}media/tmpimages/`;d.Qy&&(s="https://cloud.tagbox.com/ugc-suite/tmp/"),d.HY&&(s="https://cloud.tagshop.ai/tmp/"),this.setState(e=>({type:t.mime.includes("video")?5:4,selectedFile:t.id,selectedUrl:`${s}${t.id}.${t.ext}`,ext:t.ext,size:t.size,fileName:t.name,mediaHeight:i,mediaWidth:o,uploadedFiles:[...e.uploadedFiles,{name:t.name,url:`${s}${t.id}.${t.ext}`,id:t.localId}]}),()=>this.onUpdateLocalState()),(0,u.Uy)(2)}),this.uppyUploader.uppy.on("file-removed",(e,t)=>{(0,u.Uy)(2)}),this.uppyUploader.uppy.on("upload-progress",(e,t)=>{this.setState({uploadPercent:(t.bytesUploaded/t.bytesTotal*100).toFixed()})}),this.uppyUploader.uppy.on("upload-error",(e,t)=>{this.setState({throwError:!0})}),this.uppyUploader.uppy.on("upload-complete",(e,t)=>{this.onRemovedState(!0)})}componentDidUpdate(e){const{removedFile:t}=this.props,{uploadedFiles:i}=this.state;if(!g().isEqual(t,e.removedFile)&&y.length>0){const e=i.find(e=>e.url==t.file);if(e&&Object.keys(e).length>0){5!=t.type&&this.uppyUploader.uppy.cancelAll();const i=y.find(t=>t.id==e.id);i&&(y=y.filter(e=>e.id!==i.id)),this.setState(e=>({uploadedFiles:e.uploadedFiles.filter(e=>e.url!==t.file)}))}}}render(){var e,t;const{isLoading:i,fileSize:o,throwError:s,fileSizeText:a,filemaxSize:r,type:n,uploadPercent:d,limit:p}=this.state,{upload_image:h,formLanguage:u}=this.props;return h&&h.length<20?(0,f.jsx)(f.Fragment,{children:(0,f.jsx)("div",{className:"t_m_upload "+(h&&h.length<1?"t_m_dd":""),children:(0,f.jsx)("div",{className:"t_m_up_wrp",children:h&&h.length<1?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(l.OX,{note:null!==(e=null===u||void 0===u?void 0:u.Video_size)&&void 0!==e?e:"Video Size : Max 100MB | Photo Size : Max 15MB | Max 20 Posts",uppy:this.uppyUploader.uppy,inline:!0,maxNumberOfFiles:p,width:"100%",height:"auto",locale:{strings:{dropHereOr:null!==(t=null===u||void 0===u?void 0:u.Drag_video)&&void 0!==t?t:"Drag a video / image to upload (optional)",browse:"browse"}}}),i?(0,f.jsx)(v,{value:d,isBar:!0}):null]}):i?(0,f.jsx)(v,{value:d,isBar:!1}):(0,f.jsx)(f.Fragment,{children:(0,f.jsx)(l.zp,{uppy:this.uppyUploader.uppy,allowMultipleFiles:!0,locale:{strings:{browse:"browse"}}})})})})}):null}}const b=x},76506:(e,t,i)=>{i.d(t,{C9:()=>g,Cq:()=>m,HI:()=>u,Ph:()=>b,S2:()=>y,TW:()=>F,Uy:()=>p,fF:()=>f,hZ:()=>v,hz:()=>c,p5:()=>S,pD:()=>_,pj:()=>z,sl:()=>x,um:()=>h,wG:()=>w});var o=i(66345),s=i(80415),a=i(296),l=i(86961);let r=[],n=!1;const d=new Headers({"Content-Type":"application/json",Authorization:`Bearer ${o.$x}`,Productdomain:o.QR}),p=e=>{var t;return null===(t=document.getElementById("tb_onsite_btn_id"))||void 0===t?void 0:t.classList.toggle("tb_onsite_btn_disabled",1===e)},h=e=>{var t;if(o.aD)return window.parent.postMessage(e,"*");const i={1:()=>window.onShowDemoPost(1),2:()=>window.hendleFeeds("addFeeds"),3:()=>window.hendleFeeds("manageFeeds")};null===(t=i[e])||void 0===t||t.call(i)},u=e=>{try{r.push(e)}catch(t){console.log(t)}},c=e=>e&&""!==e&&!e.includes("ui-avatars"),m=e=>{if(!e)return"0 Byte";const t=Math.floor(Math.log(e)/Math.log(1024));return{size:Math.round(e/Math.pow(1024,t),2),sizeText:["Bytes","KB","MB","GB","TB"][t]}},g=e=>e.startsWith("http://")||e.startsWith("https://")?e:"https://"+e,f=e=>{if(!e||isNaN(e))return"invalid date";const t=new Date(1e3*e);if(isNaN(t.getTime()))return"invalid date";const i=new Date,o=i-t;if(isNaN(o)||o<0)return"invalid date";const s=i.getFullYear()-t.getFullYear();if(s>0)return`${s} year${s>1?"s":""} ago`;if(o<6e4)return"just now";const a=[{label:"month",ms:2592e6},{label:"week",ms:6048e5},{label:"day",ms:864e5},{label:"hour",ms:36e5},{label:"minute",ms:6e4}].find(e=>{let{ms:t}=e;return o>=t});if(!a)return"just now";const l=Math.floor(o/a.ms);return`${l} ${a.label}${l>1?"s":""} ago`},v=()=>[`${s.om}`,"Website Widget"],w=e=>e&&String(e)?unescape(e).split("/").pop().split("/").slice(-1).join().split(".").shift():"",y=["localhost","widget","wall_id="].every(e=>(0,o.vq)(e))?"taggbox_main":[`${o.Xg}.${o.IF}`,`${o.Xg}${o.t6}${o.IF}`,`${o.Xg}s.${o.IF}`].some(e=>(0,o.vq)(e))?"tag_main__root":o.HY?"taggShopRoot":"taggbox_main",x=e=>{const t=Math.floor(Math.log10(e)/3)||0;return t&&e?+(e/Math.pow(1e3,t)).toFixed(0)+["","K","M","B","T"][t]:e},b=e=>o.MH?e:atob(e),S=(e,t,i)=>e&&e.length>0?e.findIndex(e=>e.id===t):i,z=()=>{try{const{wall:e}=a.A.getState().appData,{webId:t,wallId:i,ownerId:s}=e.ThemeInfo;n||(window.addEventListener("beforeunload",()=>{if(0===r.length)return;const e=r.reduce((e,t)=>e+t,0);e>0?fetch(o.KQ,{method:"POST",headers:d,body:JSON.stringify({action:1,model:null!==l.Ex&&void 0!==l.Ex&&l.Ex.includes("website")?"website":"wall",playCount:r.length,wall:o.aD?i:t,playTime:e,owner:s}),keepalive:!0}).finally(()=>(r=[],n=!1)):(r=[],n=!1)}),n=!0)}catch(e){console.error(e)}},F=e=>new Promise((t,i)=>Object.assign(new Image,{onload:function(){t({width:this.naturalWidth,height:this.naturalHeight})},onerror:e=>i(new Error(`Image loading error: ${e.message}`)),src:e})),_=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{let o=0,s=0,l="",r=0,n="",d=[];if(t)return e.map(e=>{o+=e.averageReviews*e.totalReviews,s+=e.totalReviews,l="Overall",r=0,n=e.color,d=(null===e||void 0===e?void 0:e.reviewList)||[]}),{network:{name:l,avgRate:isNaN(o/s)?0:(o/s).toFixed(1),totalReviews:s,color:n,reviewList:d},activeId:r};{var i;const{wall:t}=a.A.getState().appData;let n=null===t||void 0===t||null===(i=t.Banner)||void 0===i?void 0:i.title_font_color;return e.map(i=>{var a;o+=i.averageReviews*i.totalReviews,s+=i.totalReviews,l=e.length>1?"Overall":i.name,r=e.length>1?0:i.id,n=e.length>1?null===t||void 0===t||null===(a=t.Banner)||void 0===a?void 0:a.title_font_color:i.color,d=e.length>1?(e=>{try{let t=new Map;return e.forEach(e=>{e.Network.reviewList.forEach(e=>{t.set(e.rating,(t.get(e.rating)||0)+e.count)})}),Array.from(t,e=>{let[t,i]=e;return{rating:t,count:i}})}catch(t){}})(e):(null===i||void 0===i?void 0:i.reviewList)||[]}),{network:{name:l,avgRate:isNaN(o/s)?0:(o/s).toFixed(1),totalReviews:s,color:n,reviewList:d},activeId:r}}}catch(o){console.log("ex",o)}}}}]);