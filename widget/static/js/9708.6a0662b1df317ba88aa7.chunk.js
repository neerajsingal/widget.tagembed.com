"use strict";(self.webpackChunkembed_widget=self.webpackChunkembed_widget||[]).push([[9708],{62910:(e,t,i)=>{i.r(t),i.d(t,{Loader:()=>f,default:()=>S});var a=i(9950),o=i(96011),s=i.n(o),r=i(60755),l=(i(92043),i(36907)),n=i(83535),d=i(66345),h=d.HY?"cloud.tagshop.ai":"cloud.tagbox.com";const p=class{constructor(e,t,i){var a="media/tmpimages/",o=h;d.Qy&&(a="ugc-suite/tmp/",o="cloud.tagbox.com"),d.HY&&(a="tmp/"),this.uppy=new l.A({meta:{type:"avatar"},autoProceed:!0,debug:!0,allowMultipleUploads:!0,restrictions:{maxFileSize:104857600,maxNumberOfFiles:i||1,minNumberOfFiles:1,allowedFileTypes:["image/*","video/*"]},onBeforeFileAdded:e,onBeforeUpload:t}),this.uppy.use(n.Ay,{params:{auth:{key:"0701d3d7f8d94e92a65a9cba388b1d96"},steps:{store:{robot:"/wasabi/store",bucket_region:"us-west-1",result:!0,bucket:o,key:"47ABVORKG52UYE1KB28S",secret:"pcaTfeokaz28geAAns08H3yaGbOVz6ILgTptu19v",path:a+"${file.id}.${file.ext}"}}},waitForEncoding:!0})}};var c=i(76506),u=i(80415),m=i(41397),v=i.n(m),g=i(44414),f=e=>{var{value:t,isBar:i}=e,a=Math.round((100-t)/100*182.12);return i?(0,g.jsx)("div",{className:"t_m_pb_wrap",children:(0,g.jsx)("div",{className:"t_m_pb",style:{width:"".concat(t,"%")},children:(0,g.jsx)("div",{})})}):(0,g.jsx)("div",{className:"t_m_propgress",children:(0,g.jsxs)("svg",{width:"78",height:"78",viewBox:"-10 -10 100 100",version:"1.1",xmlns:"http://www.w3.org/2000/svg",style:{transform:"rotate(-90deg)"},children:[(0,g.jsx)("circle",{r:"30",cx:"40",cy:"40",fill:"transparent",stroke:"#D9D9D9",strokeWidth:"4",strokeDasharray:"188.4px",strokeDashoffset:"0"}),(0,g.jsx)("circle",{id:"path_fr_circle",r:"30",cx:"40",cy:"40",stroke:"#545454",strokeWidth:"4",strokeLinecap:"butt",strokeDashoffset:"".concat(a,"px"),fill:"transparent",strokeDasharray:"188.4px"}),(0,g.jsxs)("text",{x:"25px",y:"47px",fill:"#545454",fontSize:"14px",style:{transform:"rotate(90deg) translate(17px, -84px)"},textAnchor:"middle",dominantBaseline:"middle",children:[t,"%"]})]})})},w=[],y=[];class x extends a.Component{constructor(){super(...arguments),this.state={isLoading:!1,selectedFile:null,selectedUrl:null,type:null,thumb_file:[],fileSize:!1,filemaxSize:0,throwError:!1,videoPath:"",fileSizeText:"",ext:null,size:0,fileName:null,mediaHeight:0,mediaWidth:0,uploadPercent:100,limit:20,uploadedFiles:[]},this.beforeFileAdded=(e,t)=>{if((this.props.checkUpload(!0),y.length>0)&&y.find((t=>t.id==e.id)))return!1;(0,c.Uy)(1);var{size:i,sizeText:a}=(0,c.Cq)(e.size),o=e.meta.type.includes("image")?4:5;if(["GB","TB"].includes(a))this.setState({type:o,fileSize:!0,fileSizeText:"".concat(i).concat(a)},(()=>{this.onLoadError(o),setTimeout((()=>this.setState({fileSize:!1,fileSizeText:""})),2e3)})),(0,c.Uy)(2);else if("MB"==a){var s=4==o?15:100;if(i>=s)return this.setState({type:o,filemaxSize:s,fileSize:!0,fileSizeText:"".concat(i).concat(a)},(()=>{this.onLoadError(o),setTimeout((()=>this.setState({fileSize:!1,fileSizeText:"",type:null},(()=>this.onLoadError(o)))),5e3)})),(0,c.Uy)(2),!1;5==o?y.length<20&&(w.push(e),y.push(e)):y.length<20&&y.push(e)}else"KB"==a&&y.length<20&&(e.meta.type.includes("video")&&w.push(e),y.push(e))},this.beforeUpload=e=>{for(var t of y)if(t.meta.type.includes("video")){this.videoProcess();break}return this.setState({isLoading:!0}),Object.fromEntries(Object.entries(e).filter((e=>{var[t,i]=e;return!i.meta.type.includes("video")})))},this.videoProcess=()=>{if(w.length>0&&y.length<=20)try{var{onsite_token:e,checkUpload:t}=this.props;this.setState({isLoading:!0});var i=w[0],a=new FormData;a.append("file",i.data),a.append("onsite_token",e);var o={headers:{productdomain:"taggbox.com"},onUploadProgress:e=>{var t=Math.round(100*e.loaded/e.total);this.setState({uploadPercent:t,isLoading:!0})}};s().post(d.Pt,a,o).then((e=>{var{responseData:a}=e.data;a&&a.length>0&&(this.setState((e=>({videoPath:a[0].sscode,isLoading:!1,type:5,selectedFile:a[0].s3Url,selectedUrl:a[0].s3Url,thumb_file:a[0].s3ThumbUrl,ext:i.extension,size:i.size,fileName:i.name,mediaHeight:a[0].height,mediaWidth:a[0].width,uploadedFiles:[...e.uploadedFiles,{name:i.name,url:a[0].s3Url,id:i.id}]})),(()=>{this.onUpdateLocalState(),w.shift(),this.videoProcess()})),(0,c.Uy)(2),t(!1))})).catch((e=>{y=y.filter((e=>e.id!=i.id)),this.setState({isLoading:!1,throwError:!0},(()=>setTimeout((()=>this.setState({throwError:!1})),2e3))),(0,c.Uy)(2),t(!1)}))}catch(r){this.videoProcess(),this.setState({isLoading:!1,throwError:!0},(()=>setTimeout((()=>this.setState({throwError:!1})),2e3))),this.uppyUploader.uppy.cancelAll(),(0,c.Uy)(2),this.props.checkUpload(!1)}},this.uppyUploader=new p(this.beforeFileAdded,this.beforeUpload,this.state.limit),this.onRemovedState=e=>{var{type:t}=this.state;this.setState({selectedFile:null,selectedUrl:null,type:null,thumb_file:"",fileSize:!1,fileSizeText:"",videoPath:"",ext:null,size:0,fileName:null,mediaHeight:0,mediaWidth:0},(()=>{this.onLoadError(t),e&&this.uppyUploader.uppy.cancelAll()}))},this.onUpdateLocalState=()=>{var{addPostImage:e,isActiveIndex:t}=this.props,{selectedUrl:i,type:a,thumb_file:o,videoPath:s,ext:r,size:l,fileName:n,mediaHeight:d,mediaWidth:h,uploadedFiles:p}=this.state;e(i,5===a?o:i,a,d,h,s,t,r,l,n),5===a&&this.onRemovedState(!1)},this.onLoadError=e=>{var{uploadErrorCallback:t}=this.props,{fileSize:i,fileSizeText:a,filemaxSize:o,throwError:s}=this.state,r=i?"File Size (".concat(a,") Limit Exceeded ").concat(4==e?"Image":"Video"," Size : Max ").concat(o," MB"):"",l=s?"Something went wrong , Please try again.":"";t(r||(l||""))}}componentDidMount(){this.uppyUploader.uppy.on("transloadit:result",((e,t)=>{this.setState({isLoading:!1});var i=t.meta.orientation&&"Rotate 90 CW"==t.meta.orientation?t.meta.width:t.meta.height,a=t.meta.orientation&&"Rotate 90 CW"==t.meta.orientation?t.meta.height:t.meta.width,o="".concat(u.vr,"media/tmpimages/");d.Qy&&(o="https://cloud.tagbox.com/ugc-suite/tmp/"),d.HY&&(o="https://cloud.tagshop.ai/tmp/"),this.setState((e=>({type:t.mime.includes("video")?5:4,selectedFile:t.id,selectedUrl:"".concat(o).concat(t.id,".").concat(t.ext),ext:t.ext,size:t.size,fileName:t.name,mediaHeight:i,mediaWidth:a,uploadedFiles:[...e.uploadedFiles,{name:t.name,url:"".concat(o).concat(t.id,".").concat(t.ext),id:t.localId}]})),(()=>this.onUpdateLocalState())),(0,c.Uy)(2)})),this.uppyUploader.uppy.on("file-removed",((e,t)=>{(0,c.Uy)(2)})),this.uppyUploader.uppy.on("upload-progress",((e,t)=>{this.setState({uploadPercent:(t.bytesUploaded/t.bytesTotal*100).toFixed()})})),this.uppyUploader.uppy.on("upload-error",((e,t)=>{this.setState({throwError:!0})})),this.uppyUploader.uppy.on("upload-complete",((e,t)=>{this.onRemovedState(!0)}))}componentDidUpdate(e){var{removedFile:t}=this.props,{uploadedFiles:i}=this.state;if(!v().isEqual(t,e.removedFile)&&y.length>0){var a=i.find((e=>e.url==t.file));if(a&&Object.keys(a).length>0){5!=t.type&&this.uppyUploader.uppy.cancelAll();var o=y.find((e=>e.id==a.id));o&&(y=y.filter((e=>e.id!==o.id))),this.setState((e=>({uploadedFiles:e.uploadedFiles.filter((e=>e.url!==t.file))})))}}}render(){var{isLoading:e,fileSize:t,throwError:i,fileSizeText:a,filemaxSize:o,type:s,uploadPercent:l,limit:n}=this.state,{upload_image:d,getContent:h}=this.props;return d&&d.length<20?(0,g.jsx)(g.Fragment,{children:(0,g.jsx)("div",{className:"t_m_upload ".concat(d&&d.length<1?"t_m_dd":""),children:(0,g.jsx)("div",{className:"t_m_up_wrp",children:d&&d.length<1?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(r.OX,{note:null===h||void 0===h?void 0:h.contentSize,uppy:this.uppyUploader.uppy,inline:!0,maxNumberOfFiles:n,width:"100%",height:"auto",locale:{strings:{dropHereOr:null===h||void 0===h?void 0:h.uploadText,browse:"browse"}}}),e?(0,g.jsx)(f,{value:l,isBar:!0}):null]}):e?(0,g.jsx)(f,{value:l,isBar:!1}):(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(r.zp,{uppy:this.uppyUploader.uppy,allowMultipleFiles:!0,locale:{strings:{browse:"browse"}}})})})})}):null}}const S=x},76506:(e,t,i)=>{i.d(t,{C9:()=>v,Cq:()=>m,HI:()=>c,Ph:()=>S,S2:()=>y,TW:()=>U,Uy:()=>h,fF:()=>g,hZ:()=>f,hz:()=>u,p5:()=>b,pD:()=>z,pj:()=>F,sl:()=>x,um:()=>p,wG:()=>w});var a=i(66345),o=i(80415),s=i(296),r=i(68553),l=[],n=!1,d=new Headers({"Content-Type":"application/json",Authorization:"Bearer ".concat(a.$x),Productdomain:a.QR}),h=e=>{var t;return null===(t=document.getElementById("tb_onsite_btn_id"))||void 0===t?void 0:t.classList.toggle("tb_onsite_btn_disabled",1===e)},p=e=>{var t;if(a.aD)return window.parent.postMessage(e,"*");var i={1:()=>window.onShowDemoPost(1),2:()=>window.hendleFeeds("addFeeds"),3:()=>window.hendleFeeds("manageFeeds")};null===(t=i[e])||void 0===t||t.call(i)},c=e=>{try{l.push(e)}catch(t){console.log(t)}},u=e=>e&&""!==e&&!e.includes("ui-avatars"),m=e=>{if(!e)return"0 Byte";var t=Math.floor(Math.log(e)/Math.log(1024));return{size:Math.round(e/Math.pow(1024,t),2),sizeText:["Bytes","KB","MB","GB","TB"][t]}},v=e=>e.startsWith("http://")||e.startsWith("https://")?e:"https://"+e,g=e=>{var t,{wall:i}=s.A.getState().appData,a=[1778189].includes(null===i||void 0===i||null===(t=i.ThemeInfo)||void 0===t?void 0:t.ownerId)?"fr":"en";if(!e||isNaN(e))return"fr"===a?"date invalide":"invalid date";var o=new Date(1e3*e);if(isNaN(o.getTime()))return"fr"===a?"date invalide":"invalid date";var r=new Date,l=r-o;if(isNaN(l)||l<0)return"fr"===a?"date invalide":"invalid date";var n={en:{justNow:"just now",year:"year",years:"years",month:"month",months:"months",week:"week",weeks:"weeks",day:"day",days:"days",hour:"hour",hours:"hours",minute:"minute",minutes:"minutes",prefix:"",suffix:" ago"},fr:{justNow:"\xe0 l\u2019instant",year:"an",years:"ans",month:"mois",months:"mois",week:"semaine",weeks:"semaines",day:"jour",days:"jours",hour:"heure",hours:"heures",minute:"minute",minutes:"minutes",prefix:"il y a ",suffix:""}},d=n[a]||n.en,h=r.getFullYear()-o.getFullYear();if(h>0)return"".concat(d.prefix).concat(h," ").concat(h>1?d.years:d.year).concat(d.suffix);var p=[{single:d.month,plural:d.months,ms:2592e6},{single:d.week,plural:d.weeks,ms:6048e5},{single:d.day,plural:d.days,ms:864e5},{single:d.hour,plural:d.hours,ms:36e5},{single:d.minute,plural:d.minutes,ms:6e4}];if(l<6e4)return d.justNow;var c=p.find((e=>{var{ms:t}=e;return l>=t}));if(!c)return d.justNow;var u=Math.floor(l/c.ms);return"".concat(d.prefix).concat(u," ").concat(u>1?c.plural:c.single).concat(d.suffix)},f=e=>3==e?o.lY:o.TF,w=e=>e&&String(e)?unescape(e).split("/").pop().split("/").slice(-1).join().split(".").shift():"",y=["localhost","widget","wall_id="].every((e=>(0,a.vq)(e)))?"taggbox_main":["".concat(a.Xg,".").concat(a.IF),"".concat(a.Xg).concat(a.t6).concat(a.IF),"".concat(a.Xg,"s.").concat(a.IF)].some((e=>(0,a.vq)(e)))?"tag_main__root":a.HY?"taggShopRoot":"taggbox_main",x=e=>{var t=Math.floor(Math.log10(e)/3)||0;if(0===t)return e.toString();var i=(e/Math.pow(1e3,t)).toFixed(2),a=parseFloat(i)+["","K","M","B","T"][t];return i&&"NaN"!=i?a:0},S=e=>a.MH?e:atob(e),b=(e,t,i)=>e&&e.length>0?e.findIndex((e=>e.id===t)):i,F=()=>{try{var{wall:e}=s.A.getState().appData,{webId:t,wallId:i,ownerId:o}=e.ThemeInfo;n||(window.addEventListener("beforeunload",(()=>{if(0!==l.length){var e=l.reduce(((e,t)=>e+t),0);e>0?fetch(a.KQ,{method:"POST",headers:d,body:JSON.stringify({action:1,model:null!==r.Ex&&void 0!==r.Ex&&r.Ex.includes("website")?"website":"wall",playCount:l.length,wall:a.aD?i:t,playTime:e,owner:o}),keepalive:!0}).finally((()=>(l=[],n=!1))):(l=[],n=!1)}})),n=!0)}catch(h){console.error(h)}},U=e=>new Promise(((t,i)=>Object.assign(new Image,{onload:function(){t({width:this.naturalWidth,height:this.naturalHeight})},onerror:e=>i(new Error("Image loading error: ".concat(e.message))),src:e}))),z=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{var i=0,a=0,o="",r=0,l="",n=[];if(t)return e.map((e=>{i+=e.averageReviews*e.totalReviews,a+=e.totalReviews,o="Overall",r=0,l=e.color,n=(null===e||void 0===e?void 0:e.reviewList)||[]})),{network:{name:o,avgRate:isNaN(i/a)?0:(i/a).toFixed(1),totalReviews:a,color:l,reviewList:n},activeId:r};var d,{wall:h}=s.A.getState().appData,p=null===h||void 0===h||null===(d=h.Banner)||void 0===d?void 0:d.title_font_color;return e.map((t=>{var s;i+=t.averageReviews*t.totalReviews,a+=t.totalReviews,o=e.length>1?"Overall":t.name,r=e.length>1?0:t.id,p=e.length>1?null===h||void 0===h||null===(s=h.Banner)||void 0===s?void 0:s.title_font_color:t.color,n=e.length>1?(e=>{try{var t=new Map;return e.forEach((e=>{e.Network.reviewList.forEach((e=>{t.set(e.rating,(t.get(e.rating)||0)+e.count)}))})),Array.from(t,(e=>{var[t,i]=e;return{rating:t,count:i}}))}catch(i){}})(e):(null===t||void 0===t?void 0:t.reviewList)||[]})),{network:{name:o,avgRate:isNaN(i/a)?0:(i/a).toFixed(1),totalReviews:a,color:p,reviewList:n},activeId:r}}catch(c){console.log("ex",c)}}}}]);